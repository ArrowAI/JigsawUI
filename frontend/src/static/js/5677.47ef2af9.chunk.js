"use strict";(self.webpackChunkui=self.webpackChunkui||[]).push([[5677],{84164:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(99586);const o={getAllChatflows:()=>a.Z.get("/flows"),createNewChatflowVersion:(e,t)=>a.Z.post("/flows/".concat(e),t),getSpecificChatflow:e=>a.Z.get("/flows/".concat(e)),getSpecificChatflowFromPublicEndpoint:e=>a.Z.get("/public-chatflows/".concat(e)),createNewChatflow:e=>a.Z.post("/flows",e),updateChatflow:(e,t)=>a.Z.put("/flows/".concat(e),t),deleteChatflow:e=>a.Z.delete("/flows/".concat(e)),getIsChatflowStreaming:e=>a.Z.get("/chatflows-streaming/".concat(e))}},8820:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Zt});var a=n(4048),o=n(10270),s=n(85612),r=n(72117),i=(n(9304),n(70911)),l=n(61176),c=n(70428),d=n(40249),u=(n(11248),n(16442)),p=n(77951);function h(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{navigator:n}=(0,a.useContext)(p.Us);(0,a.useEffect)((()=>{if(!t)return;const a=n.block((t=>{const n={...t,retry(){a(),t.retry()}};e(n)}));return a}),[n,e,t])}((0,a.useCallback)((t=>{window.confirm(e)&&t.retry()}),[e]),t)}var f=n(21131),m=n(41234),g=n(69652),x=n(79527),v=n(97668),y=n(15289),w=n(67796),b=n(47704),j=n(8537),C=n(60080);const k=e=>{let{id:t,sourceX:n,sourceY:s,targetX:r,targetY:i,sourcePosition:l,targetPosition:c,style:d={},data:p,markerEnd:h}=e;const[m,g,x]=(0,o.OQ)({sourceX:n,sourceY:s,sourcePosition:l,targetX:r,targetY:i,targetPosition:c}),{deleteEdge:v}=(0,a.useContext)(j.K),y=(0,u.I0)();return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("path",{id:t,style:d,className:"react-flow__edge-path",d:m,markerEnd:h}),p&&p.label&&(0,C.jsx)(o.f6,{x:n+10,y:s+10,label:p.label,labelStyle:{fill:"black"},labelBgStyle:{fill:"transparent"},labelBgPadding:[2,4],labelBgBorderRadius:2}),(0,C.jsx)("foreignObject",{width:40,height:40,x:g-20,y:x-20,className:"edgebutton-foreignobject",requiredExtensions:"http://www.w3.org/1999/xhtml",children:(0,C.jsx)("div",{children:(0,C.jsx)("button",{className:"edgebutton",onClick:e=>((e,t)=>{e.stopPropagation(),v(t),y({type:f.K8})})(e,t),children:"\xd7"})})})]})};var Z=n(21982),S=n(37752),D=n(37507),A=n(79049),I=n(41010),T=n(62424),M=n(45730),P=n(92824),N=n(1647),R=n(76113),q=n(27408),F=n(20842),B=n(58);const E=e=>{let{show:t,dialogProps:n,onCancel:o,onConfirm:s}=e;const[r,i]=(0,a.useState)(null),[l,c]=(0,a.useState)(""),[d,u]=(0,a.useState)(!1);(0,a.useEffect)((()=>{i(document.getElementById("portal"))}),[t]),(0,a.useEffect)((()=>{u(!!l)}),[l]);const p=t?(0,C.jsxs)(P.Z,{open:t,fullWidth:!0,maxWidth:"xs",onClose:o,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,C.jsx)(N.Z,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:n.title}),(0,C.jsx)(R.Z,{children:(0,C.jsx)(q.Z,{sx:{mt:1},id:"chatflow-name",type:"text",fullWidth:!0,placeholder:"My New Chatflow",value:l,onChange:e=>c(e.target.value)})}),(0,C.jsxs)(F.Z,{children:[(0,C.jsx)(g.Z,{onClick:o,children:n.cancelButtonName}),(0,C.jsx)(B.S,{disabled:!d,variant:"contained",onClick:()=>s(l),children:n.confirmButtonName})]})]}):null;return r?(0,M.createPortal)(p,r):null};var L=n(28373),H=n(44410),z=n(14260),O=n(33915),_=n(26645),U=n(53471),K=n(28285),J=n(23574),W=n(27784),X=n(29501),Y=n(84164),V=n(75963),G=n(53427);const $="#ffffff",Q=16,ee="#303235",te={backgroundColor:"#f7f8ff",textColor:"#303235"},ne={backgroundColor:"#3B81F6",textColor:"#ffffff"},ae={backgroundColor:"#ffffff",textColor:"#303235",sendButtonColor:"#3B81F6"},oe=e=>{var t,n,o,s,r,i,l,c,p,h,m,v,y,b,j,k,Z,S,A,I,M,P,N,R,F,E,L,H,z,O;let{isSessionMemory:_}=e;const oe=(0,u.I0)(),se=(0,w.Z)(),re=(0,u.v9)((e=>e.canvas.chatflow)),ie=re.id,le=re.chatbotConfig?JSON.parse(re.chatbotConfig):{};(0,V.Z)();const ce=function(){return oe((0,f.yv)(...arguments))},de=function(){return oe((0,f.sy)(...arguments))},[ue,pe]=(0,a.useState)(null!==(t=re.isPublic)&&void 0!==t&&t),[he,fe]=(0,a.useState)(null!==(n=null===le||void 0===le?void 0:le.generateNewSession)&&void 0!==n&&n),[me,ge]=(0,a.useState)(null!==(o=null===le||void 0===le?void 0:le.welcomeMessage)&&void 0!==o?o:""),[xe,ve]=(0,a.useState)(null!==(s=null===le||void 0===le?void 0:le.backgroundColor)&&void 0!==s?s:$),[ye,we]=(0,a.useState)(null!==(r=null===le||void 0===le?void 0:le.fontSize)&&void 0!==r?r:Q),[be,je]=(0,a.useState)(null!==(i=null===le||void 0===le?void 0:le.poweredByTextColor)&&void 0!==i?i:ee),[Ce,ke]=(0,a.useState)(null!==(l=null===le||void 0===le||null===(c=le.botMessage)||void 0===c?void 0:c.backgroundColor)&&void 0!==l?l:te.backgroundColor),[Ze,Se]=(0,a.useState)(null!==(p=null===le||void 0===le||null===(h=le.botMessage)||void 0===h?void 0:h.textColor)&&void 0!==p?p:te.textColor),[De,Ae]=(0,a.useState)(null!==(m=null===le||void 0===le||null===(v=le.botMessage)||void 0===v?void 0:v.avatarSrc)&&void 0!==m?m:""),[Ie,Te]=(0,a.useState)(null!==(y=null===le||void 0===le||null===(b=le.botMessage)||void 0===b?void 0:b.showAvatar)&&void 0!==y&&y),[Me,Pe]=(0,a.useState)(null!==(j=null===le||void 0===le||null===(k=le.userMessage)||void 0===k?void 0:k.backgroundColor)&&void 0!==j?j:ne.backgroundColor),[Ne,Re]=(0,a.useState)(null!==(Z=null===le||void 0===le||null===(S=le.userMessage)||void 0===S?void 0:S.textColor)&&void 0!==Z?Z:ne.textColor),[qe,Fe]=(0,a.useState)(null!==(A=null===le||void 0===le||null===(I=le.userMessage)||void 0===I?void 0:I.avatarSrc)&&void 0!==A?A:""),[Be,Ee]=(0,a.useState)(null!==(M=null===le||void 0===le||null===(P=le.userMessage)||void 0===P?void 0:P.showAvatar)&&void 0!==M&&M),[Le,He]=(0,a.useState)(null!==(N=null===le||void 0===le||null===(R=le.textInput)||void 0===R?void 0:R.backgroundColor)&&void 0!==N?N:ae.backgroundColor),[ze,Oe]=(0,a.useState)(null!==(F=null===le||void 0===le||null===(E=le.textInput)||void 0===E?void 0:E.textColor)&&void 0!==F?F:ae.textColor),[_e,Ue]=(0,a.useState)(null!==(L=null===le||void 0===le||null===(H=le.textInput)||void 0===H?void 0:H.placeholder)&&void 0!==L?L:""),[Ke,Je]=(0,a.useState)(null!==(z=null===le||void 0===le||null===(O=le.textInput)||void 0===O?void 0:O.sendButtonColor)&&void 0!==z?z:ae.sendButtonColor),[We,Xe]=(0,a.useState)(null),[Ye,Ve]=(0,a.useState)(""),[Ge,$e]=(0,a.useState)(""),Qe=Boolean(We),[et,tt]=(0,a.useState)(null),nt=Boolean(et),at=()=>{const e={botMessage:{showAvatar:!1},userMessage:{showAvatar:!1},textInput:{},overrideConfig:{}};return me&&(e.welcomeMessage=me),xe&&(e.backgroundColor=xe),ye&&(e.fontSize=ye),be&&(e.poweredByTextColor=be),Ce&&(e.botMessage.backgroundColor=Ce),Ze&&(e.botMessage.textColor=Ze),De&&(e.botMessage.avatarSrc=De),Ie&&(e.botMessage.showAvatar=Ie),Me&&(e.userMessage.backgroundColor=Me),Ne&&(e.userMessage.textColor=Ne),qe&&(e.userMessage.avatarSrc=qe),Be&&(e.userMessage.showAvatar=Be),Le&&(e.textInput.backgroundColor=Le),ze&&(e.textInput.textColor=ze),_e&&(e.textInput.placeholder=_e),Ke&&(e.textInput.sendButtonColor=Ke),_&&(e.overrideConfig.generateNewSession=he),e},ot=()=>{tt(null)},st=(e,t,n)=>(0,C.jsx)(x.Z,{sx:{pt:2,pb:2},children:(0,C.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,C.jsx)(d.Z,{sx:{mb:1},children:n}),(0,C.jsx)(x.Z,{sx:{cursor:"pointer",width:"30px",height:"30px",border:"1px solid #616161",marginRight:"10px",backgroundColor:null!==e&&void 0!==e?e:"#ffffff",borderRadius:"5px"},onClick:n=>{Ve(t),$e(null!==e&&void 0!==e?e:"#ffffff"),Xe(n.currentTarget)}})]})}),rt=(e,t,n)=>(0,C.jsx)(x.Z,{sx:{pt:2,pb:2},children:(0,C.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,C.jsx)(d.Z,{sx:{mb:1},children:n}),(0,C.jsx)(K.Z,{id:t,checked:e,onChange:e=>{((e,t)=>{switch(t){case"botMessageShowAvatar":Te(e);break;case"userMessageShowAvatar":Ee(e);break;case"generateNewSession":fe(e)}})(e.target.checked,t)}})]})}),it=function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"string",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return(0,C.jsx)(x.Z,{sx:{pt:2,pb:2},children:(0,C.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,C.jsx)(d.Z,{sx:{mb:1},children:n}),(0,C.jsx)(q.Z,{id:t,type:a,fullWidth:!0,value:e,placeholder:o,name:t,onChange:e=>{((e,t)=>{switch(t){case"welcomeMessage":ge(e);break;case"fontSize":we(e);break;case"botMessageAvatarSrc":Ae(e);break;case"userMessageAvatarSrc":Fe(e);break;case"textInputPlaceholder":Ue(e)}})(e.target.value,t)}})]})})};return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)(D.Z,{direction:"row",children:[(0,C.jsx)(d.Z,{sx:{p:1,borderRadius:10,backgroundColor:se.palette.primary.light,width:"max-content",height:"max-content"},variant:"h5",children:"".concat(G.v2,"/chatbot/").concat(ie)}),(0,C.jsx)(J.Z,{title:"Copy Link",color:"success",onClick:e=>{navigator.clipboard.writeText("".concat(G.v2,"/chatbot/").concat(ie)),tt(e.currentTarget),setTimeout((()=>{ot()}),1500)},children:(0,C.jsx)(T.vUr,{})}),(0,C.jsx)(J.Z,{title:"Open New Tab",color:"primary",onClick:()=>window.open("".concat(G.v2,"/chatbot/").concat(ie),"_blank"),children:(0,C.jsx)(T.m7l,{})}),(0,C.jsx)("div",{style:{flex:1}}),(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,C.jsx)(K.Z,{checked:ue,onChange:e=>{pe(e.target.checked),(async e=>{try{const t=await Y.Z.updateChatflow(ie,{isPublic:e});t.data&&(ce({message:"Chatbot Configuration Saved",options:{key:(new Date).getTime()+Math.random(),variant:"success",action:e=>(0,C.jsx)(g.Z,{style:{color:"white"},onClick:()=>de(e),children:(0,C.jsx)(T.kLi,{})})}}),oe({type:f.ch,chatflow:t.data}))}catch(t){console.error(t);const e=t.response.data||"".concat(t.response.status,": ").concat(t.response.statusText);ce({message:"Failed to save Chatbot Configuration: ".concat(e),options:{key:(new Date).getTime()+Math.random(),variant:"error",persist:!0,action:e=>(0,C.jsx)(g.Z,{style:{color:"white"},onClick:()=>de(e),children:(0,C.jsx)(T.kLi,{})})}})}})(e.target.checked)}}),(0,C.jsx)(d.Z,{children:"Make Public"}),(0,C.jsx)(X.H,{style:{marginLeft:10},title:"Making public will allow anyone to access the chatbot without username & password"})]})]}),it(me,"welcomeMessage","Welcome Message","string","Hello! This is custom welcome message"),st(xe,"backgroundColor","Background Color"),it(ye,"fontSize","Font Size","number"),st(be,"poweredByTextColor","PoweredBy TextColor"),(0,C.jsx)(d.Z,{variant:"h4",sx:{mb:1,mt:2},children:"Bot Message"}),st(Ce,"botMessageBackgroundColor","Background Color"),st(Ze,"botMessageTextColor","Text Color"),it(De,"botMessageAvatarSrc","Avatar Link","string","https://raw.githubusercontent.com/zahidkhawaja/langchain-chat-nextjs/main/public/parroticon.png"),rt(Ie,"botMessageShowAvatar","Show Avatar"),(0,C.jsx)(d.Z,{variant:"h4",sx:{mb:1,mt:2},children:"User Message"}),st(Me,"userMessageBackgroundColor","Background Color"),st(Ne,"userMessageTextColor","Text Color"),it(qe,"userMessageAvatarSrc","Avatar Link","string","https://raw.githubusercontent.com/zahidkhawaja/langchain-chat-nextjs/main/public/usericon.png"),rt(Be,"userMessageShowAvatar","Show Avatar"),(0,C.jsx)(d.Z,{variant:"h4",sx:{mb:1,mt:2},children:"Text Input"}),st(Le,"textInputBackgroundColor","Background Color"),st(ze,"textInputTextColor","Text Color"),it(_e,"textInputPlaceholder","TextInput Placeholder","string","Type question.."),st(Ke,"textInputSendButtonColor","TextIntput Send Button Color"),_&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(d.Z,{variant:"h4",sx:{mb:1,mt:2},children:"Session Memory"}),rt(he,"generateNewSession","Start new session when chatbot link is opened or refreshed")]}),(0,C.jsx)(B.S,{style:{marginBottom:10,marginTop:10},variant:"contained",onClick:()=>(async()=>{try{const e=await Y.Z.updateChatflow(ie,{chatbotConfig:JSON.stringify(at())});e.data&&(ce({message:"Chatbot Configuration Saved",options:{key:(new Date).getTime()+Math.random(),variant:"success",action:e=>(0,C.jsx)(g.Z,{style:{color:"white"},onClick:()=>de(e),children:(0,C.jsx)(T.kLi,{})})}}),oe({type:f.ch,chatflow:e.data}))}catch(e){console.error(e);const t=e.response.data||"".concat(e.response.status,": ").concat(e.response.statusText);ce({message:"Failed to save Chatbot Configuration: ".concat(t),options:{key:(new Date).getTime()+Math.random(),variant:"error",persist:!0,action:e=>(0,C.jsx)(g.Z,{style:{color:"white"},onClick:()=>de(e),children:(0,C.jsx)(T.kLi,{})})}})}})(),children:"Save Changes"}),(0,C.jsx)(W.ZP,{open:Qe,anchorEl:We,onClose:()=>{Xe(null)},anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},children:(0,C.jsx)(U.xS,{color:Ge,onChange:e=>(e=>{switch(Ye){case"backgroundColor":ve(e);break;case"poweredByTextColor":je(e);break;case"botMessageBackgroundColor":ke(e);break;case"botMessageTextColor":Se(e);break;case"userMessageBackgroundColor":Pe(e);break;case"userMessageTextColor":Re(e);break;case"textInputBackgroundColor":He(e);break;case"textInputTextColor":Oe(e);break;case"textInputSendButtonColor":Je(e)}$e(e)})(e.hex)})}),(0,C.jsx)(W.ZP,{open:nt,anchorEl:et,onClose:ot,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},children:(0,C.jsx)(d.Z,{variant:"h6",sx:{pl:1,pr:1,color:"white",background:se.palette.success.dark},children:"Copied!"})})]})};var se=n(49730),re=n(1116);const ie=e=>{let{value:t,label:n,onChange:o,disabled:s=!1}=e;const[r,i]=(0,a.useState)(t);return(0,C.jsx)(C.Fragment,{children:(0,C.jsx)(se.Z,{sx:{mt:1,width:"100%"},size:"small",control:(0,C.jsx)(re.Z,{disabled:s,checked:r,onChange:e=>{i(e.target.checked),o(e.target.checked)}}),label:n})})};function le(e){const{children:t,value:n,index:a,...o}=e;return(0,C.jsx)("div",{role:"tabpanel",hidden:n!==a,id:"attachment-tabpanel-".concat(a),"aria-labelledby":"attachment-tab-".concat(a),...o,children:n===a&&(0,C.jsx)(x.Z,{sx:{p:1},children:t})})}function ce(e){return{id:"attachment-tab-".concat(e),"aria-controls":"attachment-tabpanel-".concat(e)}}const de=function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?'button: {\n                    backgroundColor: "#3B81F6",\n                    right: 20,\n                    bottom: 20,\n                    size: "medium",\n                    iconColor: "white",\n                    customIconSrc: "https://raw.githubusercontent.com/walkxcode/dashboard-icons/main/svg/google-messages.svg",\n                }':'button: {\n                backgroundColor: "#3B81F6",\n                right: 20,\n                bottom: 20,\n                size: "medium",\n                iconColor: "white",\n                customIconSrc: "https://raw.githubusercontent.com/walkxcode/dashboard-icons/main/svg/google-messages.svg",\n            }'},ue=function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?'chatWindow: {\n                    welcomeMessage: "Hello! This is custom welcome message",\n                    backgroundColor: "#ffffff",\n                    height: 700,\n                    width: 400,\n                    fontSize: 16,\n                    poweredByTextColor: "#303235",\n                    botMessage: {\n                        backgroundColor: "#f7f8ff",\n                        textColor: "#303235",\n                        showAvatar: true,\n                        avatarSrc: "https://raw.githubusercontent.com/zahidkhawaja/langchain-chat-nextjs/main/public/parroticon.png",\n                    },\n                    userMessage: {\n                        backgroundColor: "#3B81F6",\n                        textColor: "#ffffff",\n                        showAvatar: true,\n                        avatarSrc: "https://raw.githubusercontent.com/zahidkhawaja/langchain-chat-nextjs/main/public/usericon.png",\n                    },\n                    textInput: {\n                        placeholder: "Type your question",\n                        backgroundColor: "#ffffff",\n                        textColor: "#303235",\n                        sendButtonColor: "#3B81F6",\n                    }\n                }':'chatWindow: {\n                welcomeMessage: "Hello! This is custom welcome message",\n                backgroundColor: "#ffffff",\n                height: 700,\n                width: 400,\n                fontSize: 16,\n                poweredByTextColor: "#303235",\n                botMessage: {\n                    backgroundColor: "#f7f8ff",\n                    textColor: "#303235",\n                    showAvatar: true,\n                    avatarSrc: "https://raw.githubusercontent.com/zahidkhawaja/langchain-chat-nextjs/main/public/parroticon.png",\n                },\n                userMessage: {\n                    backgroundColor: "#3B81F6",\n                    textColor: "#ffffff",\n                    showAvatar: true,\n                    avatarSrc: "https://raw.githubusercontent.com/zahidkhawaja/langchain-chat-nextjs/main/public/usericon.png",\n                },\n                textInput: {\n                    placeholder: "Type your question",\n                    backgroundColor: "#ffffff",\n                    textColor: "#303235",\n                    sendButtonColor: "#3B81F6",\n                }\n            }'},pe=e=>{let{chatflowid:t}=e;const n=["Popup Html","Fullpage Html","Popup React","Fullpage React"],[o,s]=(0,a.useState)(0),[r,i]=(0,a.useState)(!1),l=e=>{i(e)},c=e=>{switch(e){case"Popup Html":return(e=>'<script type="module">\n    import Chatbot from "https://cdn.jsdelivr.net/npm/flowise-embed/dist/web.js"\n    Chatbot.init({\n        chatflowid: "'.concat(e,'",\n        apiHost: "').concat(G.v2,'",\n    })\n<\/script>'))(t);case"Fullpage Html":return(e=>'<flowise-fullchatbot></flowise-fullchatbot>\n<script type="module">\n    import Chatbot from "https://cdn.jsdelivr.net/npm/flowise-embed/dist/web.js"\n    Chatbot.initFull({\n        chatflowid: "'.concat(e,'",\n        apiHost: "').concat(G.v2,'",\n    })\n<\/script>'))(t);case"Popup React":return(e=>"import { BubbleChat } from 'flowise-embed-react'\n\nconst App = () => {\n    return (\n        <BubbleChat chatflowid=\"".concat(e,'" apiHost="').concat(G.v2,'" />\n    );\n};'))(t);case"Fullpage React":return(e=>'import { FullPageChat } from "flowise-embed-react"\n\nconst App = () => {\n    return (\n        <FullPageChat\n            chatflowid="'.concat(e,'"\n            apiHost="').concat(G.v2,'"\n        />\n    );\n};'))(t);default:return""}},d=e=>{switch(e){case"Popup Html":return(e=>'<script type="module">\n    import Chatbot from "https://cdn.jsdelivr.net/npm/flowise-embed/dist/web.js"\n    Chatbot.init({\n        chatflowid: "'.concat(e,'",\n        apiHost: "').concat(G.v2,'",\n        chatflowConfig: {\n            // topK: 2\n        },\n        theme: {\n            ').concat(de(),",\n            ").concat(ue(),"\n        }\n    })\n<\/script>"))(t);case"Fullpage Html":return(e=>'<flowise-fullchatbot></flowise-fullchatbot>\n<script type="module">\n    import Chatbot from "https://cdn.jsdelivr.net/npm/flowise-embed/dist/web.js"\n    Chatbot.initFull({\n        chatflowid: "'.concat(e,'",\n        apiHost: "').concat(G.v2,'",\n        theme: {\n            ').concat(ue(),"\n        }\n    })\n<\/script>"))(t);case"Popup React":return(e=>"import { BubbleChat } from 'flowise-embed-react'\n\nconst App = () => {\n    return (\n        <BubbleChat\n            chatflowid=\"".concat(e,'"\n            apiHost="').concat(G.v2,'"\n            theme={{\n                ').concat(de(!0),",\n                ").concat(ue(!0),"\n            }}\n        />\n    );\n};"))(t);case"Fullpage React":return(e=>'import { FullPageChat } from "flowise-embed-react"\n\nconst App = () => {\n    return (\n        <FullPageChat\n            chatflowid="'.concat(e,'"\n            apiHost="').concat(G.v2,'"\n            theme={{\n                ').concat(ue(!0),"\n            }}\n        />\n    );\n};"))(t);default:return""}};return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:(0,C.jsx)("div",{style:{flex:80},children:(0,C.jsx)(L.Z,{value:o,onChange:(e,t)=>{s(t)},"aria-label":"tabs",children:n.map(((e,t)=>(0,C.jsx)(H.Z,{label:e,...ce(t)},t)))})})}),(0,C.jsx)("div",{style:{marginTop:10}}),n.map(((e,t)=>(0,C.jsxs)(le,{value:o,index:t,children:[(0===o||1===o)&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)("span",{children:["Paste this anywhere in the ",(0,C.jsx)("code",{children:"<body>"})," tag of your html file.",(0,C.jsxs)("p",{children:["You can also specify a\xa0",(0,C.jsx)("a",{rel:"noreferrer",target:"_blank",href:"https://www.npmjs.com/package/flowise-embed?activeTab=versions",children:"version"}),":\xa0",(0,C.jsx)("code",{children:"https://cdn.jsdelivr.net/npm/flowise-embed@<version>/dist/web.js"})]})]}),(0,C.jsx)("div",{style:{height:10}})]}),(0,C.jsx)(z.Z1,{theme:z.FE,text:c(e),language:"javascript",showLineNumbers:!1,wrapLines:!0}),(0,C.jsx)(ie,{label:"Show Embed Chat Config",value:r,onChange:l}),r&&(0,C.jsx)(z.Z1,{theme:z.FE,text:d(e),language:"javascript",showLineNumbers:!1,wrapLines:!0})]},t)))]})};const he=n.p+"static/media/python.b0fd2326ee21d9c5524d0d243379c879.svg";const fe=n.p+"static/media/javascript.0baf38b3d3f5b2d24e87fb5cc2fcfea0.svg";const me=n.p+"static/media/cURL.37eb8ccceafb9e8630a53aa0eb756128.svg";const ge=n.p+"static/media/embed.289f71beedf481a4fab870e9fed16fec.svg",xe=n.p+"static/media/sharing.932311c91d3fa05253cc.png";var ve=n(99586);const ye=()=>ve.Z.get("/apikey");var we=n(13229),be=n(91856),je=n(71785);function Ce(e){const{children:t,value:n,index:a,...o}=e;return(0,C.jsx)("div",{role:"tabpanel",hidden:n!==a,id:"attachment-tabpanel-".concat(a),"aria-labelledby":"attachment-tab-".concat(a),...o,children:n===a&&(0,C.jsx)(x.Z,{sx:{p:1},children:t})})}function ke(e){return{id:"attachment-tab-".concat(e),"aria-controls":"attachment-tabpanel-".concat(e)}}const Ze=e=>{const t=e.find((e=>"files"===e.name));return t&&(e=e.filter((e=>"files"!==e.name)),e.unshift(t)),e},Se=(e,t)=>{let n="";e=Ze(e);const a=Math.min(e.length,4);for(let o=0;o<a;o+=1){const s=e[o];let r='"example"';"string"===s.type?r='"example"':"boolean"===s.type?r="true":"number"===s.type?r="1":"files"===s.name&&(r="input.files[0]"),n+="json"===t?'\n      "'.concat(s.name,'": ').concat(r,","):'formData.append("'.concat(s.name,'", ').concat(r,")\n"),o===a-1&&"json"!==t&&(n+='formData.append("question", "Hey, how are you?")\n')}return n},De=(e,t)=>{let n="";e=Ze(e);const a=Math.min(e.length,4);for(let o=0;o<a;o+=1){const s=e[o];let r='"example"';if("string"===s.type)r='"example"';else if("boolean"===s.type)r="true";else if("number"===s.type)r="1";else if("files"===s.name)continue;n+="json"===t?'\n        "'.concat(s.name,'": ').concat(r,","):'\n    "'.concat(s.name,'": ').concat(r,","),o===a-1&&"json"!==t&&(n+='\n    "question": "Hey, how are you?"\n')}return n},Ae=(e,t)=>{let n="";e=Ze(e);const a=Math.min(e.length,4);for(let o=0;o<a;o+=1){const s=e[o];let r="example";"string"===s.type?r="json"===t?'"example"':"example":"boolean"===s.type?r="true":"number"===s.type?r="1":"files"===s.name&&(r="@/home/user1/Desktop/example".concat(s.type)),n+="json"===t?'"'.concat(s.name,'": ').concat(r):'\n     -F "'.concat(s.name,"=").concat(r,'"'),n+=o===a-1?"json"===t?" }":' \\\n     -F "question=Hey, how are you?"':"json"===t?", ":" \\"}return n},Ie=e=>{var t,n;let{show:o,dialogProps:s,onCancel:r}=e;const[h,m]=(0,a.useState)(null),g=(0,p.s0)(),x=(0,u.I0)();(0,a.useEffect)((()=>{m(document.getElementById("portal"))}),[o]);const v=["Embed","Python","JavaScript","cURL","Share Chatbot"],[y,w]=(0,a.useState)(0),[b,j]=(0,a.useState)([]),[k,Z]=(0,a.useState)([]),[S,D]=(0,a.useState)(""),[A,I]=(0,a.useState)({}),[q,F]=(0,a.useState)(!1),[B,E]=(0,a.useState)({}),[U,K]=(0,a.useState)({}),J=(0,be.Z)(ye),W=(0,be.Z)(Y.Z.updateChatflow),X=(0,be.Z)(Y.Z.getIsChatflowStreaming),V=(0,be.Z)(we.Z.getConfig),$=e=>{F(e),e&&V.request(s.chatflowid)},Q=e=>(t,n)=>{const a={...U};a[e]=n,K(a)};(0,a.useEffect)((()=>{W.data&&x({type:f.ch,chatflow:W.data})}),[W.data,x]),(0,a.useEffect)((()=>{V.data&&function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n={},a=e.reduce((function(e,a){return e[a.node]=e[a.node]||[],e[a.node].push(a),n[a.node]=!!t,e}),Object.create(null));E(a),K(n)}(V.data)}),[V.data]);const ee=e=>"Python"===e?'import requests\n\nAPI_URL = "'.concat(G.v2,"/api/v1/prediction/").concat(s.chatflowid,'"\n\ndef query(payload):\n    response = requests.post(API_URL, json=payload)\n    return response.json()\n    \noutput = query({\n    "question": "Hey, how are you?",\n})\n'):"JavaScript"===e?'async function query(data) {\n    const response = await fetch(\n        "'.concat(G.v2,"/api/v1/prediction/").concat(s.chatflowid,'",\n        {\n            method: "POST",\n            headers: {\n                "Content-Type": "application/json"\n            },\n            body: JSON.stringify(data)\n        }\n    );\n    const result = await response.json();\n    return result;\n}\n\nquery({"question": "Hey, how are you?"}).then((response) => {\n    console.log(response);\n});\n'):"cURL"===e?"curl ".concat(G.v2,"/api/v1/prediction/").concat(s.chatflowid,' \\\n     -X POST \\\n     -d \'{"question": "Hey, how are you?"}\' \\\n     -H "Content-Type: application/json"'):"",te=e=>"Python"===e?'import requests\n\nAPI_URL = "'.concat(G.v2,"/api/v1/prediction/").concat(s.chatflowid,'"\nheaders = {"Authorization": "Bearer ').concat(null===A||void 0===A?void 0:A.apiKey,'"}\n\ndef query(payload):\n    response = requests.post(API_URL, headers=headers, json=payload)\n    return response.json()\n    \noutput = query({\n    "question": "Hey, how are you?",\n})\n'):"JavaScript"===e?'async function query(data) {\n    const response = await fetch(\n        "'.concat(G.v2,"/api/v1/prediction/").concat(s.chatflowid,'",\n        {\n            headers: {\n                Authorization: "Bearer ').concat(null===A||void 0===A?void 0:A.apiKey,'",\n                "Content-Type": "application/json"\n            },\n            method: "POST",\n            body: JSON.stringify(data)\n        }\n    );\n    const result = await response.json();\n    return result;\n}\n\nquery({"question": "Hey, how are you?"}).then((response) => {\n    console.log(response);\n});\n'):"cURL"===e?"curl ".concat(G.v2,"/api/v1/prediction/").concat(s.chatflowid,' \\\n     -X POST \\\n     -d \'{"question": "Hey, how are you?"}\' \\\n     -H "Content-Type: application/json" \\\n     -H "Authorization: Bearer ').concat(null===A||void 0===A?void 0:A.apiKey,'"'):"",ne=e=>"Python"===e?"python":"JavaScript"===e?"javascript":"cURL"===e?"bash":"python",ae=e=>"Python"===e?he:"JavaScript"===e?fe:"Embed"===e?ge:"cURL"===e?me:"Share Chatbot"===e?xe:he,se=(e,t)=>{if("Python"===e){const e=(t=Ze(t))[0].type;return'import requests\n\nAPI_URL = "'.concat(G.v2,"/api/v1/prediction/").concat(s.chatflowid,'"\n\n# use form data to upload files\nform_data = {\n    "files": ',"('example".concat(e,"', open('example").concat(e,"', 'rb'))"),"\n}\nbody_data = {").concat(De(t,"formData"),"}\n\ndef query(form_data):\n    response = requests.post(API_URL, files=form_data, data=body_data)\n    return response.json()\n\noutput = query(form_data)\n")}return"JavaScript"===e?"// use FormData to upload files\nlet formData = new FormData();\n".concat(Se(t,"formData"),'\nasync function query(formData) {\n    const response = await fetch(\n        "').concat(G.v2,"/api/v1/prediction/").concat(s.chatflowid,'",\n        {\n            method: "POST",\n            body: formData\n        }\n    );\n    const result = await response.json();\n    return result;\n}\n\nquery(formData).then((response) => {\n    console.log(response);\n});\n'):"cURL"===e?"curl ".concat(G.v2,"/api/v1/prediction/").concat(s.chatflowid," \\\n     -X POST \\").concat(Ae(t,"formData"),' \\\n     -H "Content-Type: multipart/form-data"'):""},re=(e,t)=>{if("Python"===e){const e=(t=Ze(t))[0].type;return'import requests\n\nAPI_URL = "'.concat(G.v2,"/api/v1/prediction/").concat(s.chatflowid,'"\nheaders = {"Authorization": "Bearer ').concat(null===A||void 0===A?void 0:A.apiKey,'"}\n\n# use form data to upload files\nform_data = {\n    "files": ',"('example".concat(e,"', open('example").concat(e,"', 'rb'))"),"\n}\nbody_data = {").concat(De(t,"formData"),"}\n\ndef query(form_data):\n    response = requests.post(API_URL, headers=headers, files=form_data, data=body_data)\n    return response.json()\n\noutput = query(form_data)\n")}return"JavaScript"===e?"// use FormData to upload files\nlet formData = new FormData();\n".concat(Se(t,"formData"),'\nasync function query(formData) {\n    const response = await fetch(\n        "').concat(G.v2,"/api/v1/prediction/").concat(s.chatflowid,'",\n        {\n            headers: { Authorization: "Bearer ').concat(null===A||void 0===A?void 0:A.apiKey,'" },\n            method: "POST",\n            body: formData\n        }\n    );\n    const result = await response.json();\n    return result;\n}\n\nquery(formData).then((response) => {\n    console.log(response);\n});\n'):"cURL"===e?"curl ".concat(G.v2,"/api/v1/prediction/").concat(s.chatflowid," \\\n     -X POST \\").concat(Ae(t,"formData"),' \\\n     -H "Content-Type: multipart/form-data" \\\n     -H "Authorization: Bearer ').concat(null===A||void 0===A?void 0:A.apiKey,'"'):""},le=(e,t)=>"Python"===e?'import requests\n\nAPI_URL = "'.concat(G.v2,"/api/v1/prediction/").concat(s.chatflowid,'"\n\ndef query(payload):\n    response = requests.post(API_URL, json=payload)\n    return response.json()\n\noutput = query({\n    "question": "Hey, how are you?",\n    "overrideConfig": {').concat(De(t,"json"),"\n    }\n})\n"):"JavaScript"===e?'async function query(data) {\n    const response = await fetch(\n        "'.concat(G.v2,"/api/v1/prediction/").concat(s.chatflowid,'",\n        {\n            method: "POST",\n            headers: {\n                "Content-Type": "application/json"\n            },\n            body: JSON.stringify(data)\n        }\n    );\n    const result = await response.json();\n    return result;\n}\n\nquery({\n  "question": "Hey, how are you?",\n  "overrideConfig": {').concat(Se(t,"json"),"\n  }\n}).then((response) => {\n    console.log(response);\n});\n"):"cURL"===e?"curl ".concat(G.v2,"/api/v1/prediction/").concat(s.chatflowid,' \\\n     -X POST \\\n     -d \'{"question": "Hey, how are you?", "overrideConfig": {').concat(Ae(t,"json"),'}\' \\\n     -H "Content-Type: application/json"'):"",ce=(e,t)=>"Python"===e?'import requests\n\nAPI_URL = "'.concat(G.v2,"/api/v1/prediction/").concat(s.chatflowid,'"\nheaders = {"Authorization": "Bearer ').concat(null===A||void 0===A?void 0:A.apiKey,'"}\n\ndef query(payload):\n    response = requests.post(API_URL, headers=headers, json=payload)\n    return response.json()\n\noutput = query({\n    "question": "Hey, how are you?",\n    "overrideConfig": {').concat(De(t,"json"),"\n    }\n})\n"):"JavaScript"===e?'async function query(data) {\n    const response = await fetch(\n        "'.concat(G.v2,"/api/v1/prediction/").concat(s.chatflowid,'",\n        {\n            headers: {\n                Authorization: "Bearer ').concat(null===A||void 0===A?void 0:A.apiKey,'",\n                "Content-Type": "application/json"\n            },\n            method: "POST",\n            body: JSON.stringify(data)\n        }\n    );\n    const result = await response.json();\n    return result;\n}\n\nquery({\n  "question": "Hey, how are you?",\n  "overrideConfig": {').concat(Se(t,"json"),"\n  }\n}).then((response) => {\n    console.log(response);\n});\n"):"cURL"===e?"curl ".concat(G.v2,"/api/v1/prediction/").concat(s.chatflowid,' \\\n     -X POST \\\n     -d \'{"question": "Hey, how are you?", "overrideConfig": {').concat(Ae(t,"json"),'}\' \\\n     -H "Content-Type: application/json" \\\n     -H "Authorization: Bearer ').concat(null===A||void 0===A?void 0:A.apiKey,'"'):"",de=e=>"Python"===e?'body_data = {\n    "openAIApiKey[chatOpenAI_0]": "sk-my-openai-1st-key",\n    "openAIApiKey[openAIEmbeddings_0]": "sk-my-openai-2nd-key"\n}':"JavaScript"===e?'formData.append("openAIApiKey[chatOpenAI_0]", "sk-my-openai-1st-key")\nformData.append("openAIApiKey[openAIEmbeddings_0]", "sk-my-openai-2nd-key")':"cURL"===e?'-F "openAIApiKey[chatOpenAI_0]=sk-my-openai-1st-key" \\\n-F "openAIApiKey[openAIEmbeddings_0]=sk-my-openai-2nd-key" \\':void 0;(0,a.useEffect)((()=>{if(J.data){const e=[{label:"No Authorization",name:""}];for(const t of J.data)e.push({label:t.keyName,name:t.id});e.push({label:"- Add New Key -",name:"addnewkey"}),j(e),Z(J.data),s.chatflowApiKeyId&&(D(s.chatflowApiKeyId),I(J.data.find((e=>e.id===s.chatflowApiKeyId))))}}),[s,J.data]),(0,a.useEffect)((()=>{o&&(J.request(),X.request(s.chatflowid))}),[o]);const ue=o?(0,C.jsxs)(P.Z,{open:o,fullWidth:!0,maxWidth:"md",onClose:r,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,C.jsx)(N.Z,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:s.title}),(0,C.jsxs)(R.Z,{children:[(0,C.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,C.jsx)("div",{style:{flex:80},children:(0,C.jsx)(L.Z,{value:y,onChange:(e,t)=>{w(t)},"aria-label":"tabs",children:v.map(((e,t)=>(0,C.jsx)(H.Z,{icon:(0,C.jsx)("img",{style:{objectFit:"cover",height:15,width:"auto"},src:ae(e),alt:"code"}),iconPosition:"start",label:e,...ke(t)},t)))})}),(0,C.jsx)("div",{style:{flex:20},children:(0,C.jsx)(_.L,{name:"SelectKey",disableClearable:!0,options:b,onSelect:e=>(e=>{if("addnewkey"===e)return void g("/apikey");D(e),I(k.find((t=>t.id===e)));const t={apikeyid:e};W.request(s.chatflowid,t)})(e),value:null!==(t=null!==(n=s.chatflowApiKeyId)&&void 0!==n?n:S)&&void 0!==t?t:"Choose an API key"})})]}),(0,C.jsx)("div",{style:{marginTop:10}}),v.map(((e,t)=>{var n;return(0,C.jsxs)(Ce,{value:y,index:t,children:[("Embed"===e||"Share Chatbot"===e)&&S&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("p",{children:"You cannot use API key while embedding/sharing chatbot."}),(0,C.jsxs)("p",{children:["Please select ",(0,C.jsx)("b",{children:'"No Authorization"'})," from the dropdown at the top right corner."]})]}),"Embed"===e&&!S&&(0,C.jsx)(pe,{chatflowid:s.chatflowid}),"Embed"!==e&&"Share Chatbot"!==e&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(z.Z1,{theme:z.FE,text:S?te(e):ee(e),language:ne(e),showLineNumbers:!1,wrapLines:!0}),(0,C.jsx)(ie,{label:"Show Input Config",value:q,onChange:$}),q&&V.data&&V.data.length>0&&(0,C.jsxs)(C.Fragment,{children:[Object.keys(B).sort().map((e=>(0,C.jsxs)(i.Z,{expanded:U[e]||!1,onChange:Q(e),disableGutters:!0,children:[(0,C.jsx)(l.Z,{expandIcon:(0,C.jsx)(O.Z,{}),"aria-controls":"nodes-accordian-".concat(e),id:"nodes-accordian-header-".concat(e),children:(0,C.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,C.jsx)(d.Z,{variant:"h5",children:e}),(0,C.jsx)("div",{style:{display:"flex",flexDirection:"row",width:"max-content",borderRadius:15,background:"rgb(254,252,191)",padding:5,paddingLeft:10,paddingRight:10,marginLeft:10},children:(0,C.jsx)("span",{style:{color:"rgb(116,66,16)",fontSize:"0.825rem"},children:B[e][0].nodeId})})]})}),(0,C.jsx)(c.Z,{children:(0,C.jsx)(je.I,{rows:B[e],columns:Object.keys(B[e][0]).slice(-3)})})]},e))),(0,C.jsx)(z.Z1,{theme:z.FE,text:S?s.isFormDataRequired?re(e,V.data):ce(e,V.data):s.isFormDataRequired?se(e,V.data):le(e,V.data),language:ne(e),showLineNumbers:!1,wrapLines:!0}),(0,C.jsxs)("div",{style:{display:"flex",flexDirection:"column",borderRadius:10,background:"#d8f3dc",padding:10,marginTop:10,marginBottom:10},children:[(0,C.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,C.jsx)(T.mhH,{size:30,color:"#2d6a4f"}),(0,C.jsx)("span",{style:{color:"#2d6a4f",marginLeft:10,fontWeight:500},children:"You can also specify multiple values for a config parameter by specifying the node id"})]}),(0,C.jsx)("div",{style:{padding:10},children:(0,C.jsx)(z.Z1,{theme:z.FE,text:s.isFormDataRequired?de(e):'{\n    "overrideConfig": {\n        "openAIApiKey": {\n            "chatOpenAI_0": "sk-my-openai-1st-key",\n            "openAIEmbeddings_0": "sk-my-openai-2nd-key"\n        }\n    }\n}',language:ne(e),showLineNumbers:!1,wrapLines:!0})})]})]}),(null===(n=X.data)||void 0===n?void 0:n.isStreaming)&&(0,C.jsxs)("p",{children:["Read\xa0",(0,C.jsx)("a",{rel:"noreferrer",target:"_blank",href:"https://docs.flowiseai.com/how-to-use#streaming",children:"here"}),"\xa0on how to stream response back to application"]})]}),"Share Chatbot"===e&&!S&&(0,C.jsx)(oe,{isSessionMemory:s.isSessionMemory})]},t)}))]})]}):null;return h?(0,M.createPortal)(ue,h):null};var Te=n(8890),Me=n(80362),Pe=n(49259),Ne=n(1974);const Re=(0,Pe.ZP)(Ne.Z)((e=>{let{theme:t,color:n="primary"}=e;return{color:"white",backgroundColor:t.palette[n].main,"&:hover":{backgroundColor:t.palette[n].main,backgroundImage:"linear-gradient(rgb(0 0 0/10%) 0 0)"}}})),qe=e=>{let{chatflow:t,handleSaveFlow:n,handleDeleteFlow:o,handleLoadFlow:s,openChatBox:r,templateFlowData:i,agentflowName:l}=e;const c=(0,w.Z)(),h=(0,u.I0)(),m=(0,p.s0)(),v=(0,a.useRef)(),[y,b]=((0,a.useRef)(),(0,a.useState)(null)),[j,k]=(0,a.useState)(""),[M,P]=(0,a.useState)(!1),[N,R]=(0,a.useState)(!1),[q,F]=(0,a.useState)(!1),[B,L]=(0,a.useState)({}),H=(0,be.Z)(Y.Z.updateChatflow),z=(0,u.v9)((e=>e.canvas));return(0,a.useEffect)((()=>{H.data&&(k(H.data.name),h({type:f.ch,chatflow:H.data})),b(!1)}),[H.data]),(0,a.useEffect)((()=>{t&&k(t.name)}),[t]),(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(x.Z,{children:(0,C.jsx)(Z.Z,{title:"Back",sx:{borderRadius:"50%"},children:(0,C.jsx)(S.Z,{variant:"rounded",sx:{...c.typography.commonAvatar,...c.typography.mediumAvatar,transition:"all .2s ease-in-out",background:c.palette.secondary.light,color:c.palette.secondary.dark,"&:hover":{background:c.palette.secondary.dark,color:c.palette.secondary.light}},color:"inherit",onClick:()=>window.history.state&&window.history.state.idx>0?m(-1):m("/",{replace:!0}),children:(0,C.jsx)(T.ed9,{stroke:1.5,size:"1.3rem"})})})}),(0,C.jsxs)(x.Z,{sx:{flexGrow:1},children:[!y&&(0,C.jsxs)(D.Z,{flexDirection:"row",sx:{justifyContent:"center"},children:[(0,C.jsxs)(d.Z,{sx:{fontSize:"1.5rem",fontWeight:600,ml:2},children:[z.isDirty&&(0,C.jsx)("strong",{style:{color:c.palette.orange.main},children:"*"})," ",i?i.name:l||j]}),(null===t||void 0===t?void 0:t.id)&&(0,C.jsx)(Z.Z,{title:"Edit Name",sx:{borderRadius:"50%"},children:(0,C.jsx)(S.Z,{variant:"rounded",sx:{...c.typography.commonAvatar,...c.typography.mediumAvatar,transition:"all .2s ease-in-out",ml:1,background:c.palette.secondary.light,color:c.palette.secondary.dark,"&:hover":{background:c.palette.secondary.dark,color:c.palette.secondary.light}},color:"inherit",onClick:()=>b(!0),children:(0,C.jsx)(T.TRY,{stroke:1.5,size:"1.3rem"})})})]}),y&&(0,C.jsxs)(D.Z,{flexDirection:"row",children:[(0,C.jsx)(A.Z,{size:"small",inputRef:v,sx:{width:"50%",ml:2},defaultValue:j}),(0,C.jsx)(Z.Z,{title:"Save Name",sx:{borderRadius:"50%"},children:(0,C.jsx)(S.Z,{variant:"rounded",sx:{...c.typography.commonAvatar,...c.typography.mediumAvatar,transition:"all .2s ease-in-out",background:c.palette.success.light,color:c.palette.success.dark,ml:1,"&:hover":{background:c.palette.success.dark,color:c.palette.success.light}},color:"inherit",onClick:()=>{if(t.id){const e={name:v.current.value};H.request(t.id,e)}},children:(0,C.jsx)(T.NOm,{stroke:1.5,size:"1.3rem"})})}),(0,C.jsx)(Z.Z,{title:"Cancel",sx:{borderRadius:"50%"},children:(0,C.jsx)(S.Z,{variant:"rounded",sx:{...c.typography.commonAvatar,...c.typography.mediumAvatar,transition:"all .2s ease-in-out",background:c.palette.error.light,color:c.palette.error.dark,ml:1,"&:hover":{background:c.palette.error.dark,color:c.palette.error.light}},color:"inherit",onClick:()=>b(!1),children:(0,C.jsx)(T.kLi,{stroke:1.5,size:"1.3rem"})})})]})]}),(0,C.jsxs)(x.Z,{children:[(null===t||void 0===t?void 0:t.id)&&(0,C.jsx)(Z.Z,{title:"API Endpoint",sx:{borderRadius:"50%",mr:2},children:(0,C.jsx)(S.Z,{variant:"rounded",sx:{...c.typography.commonAvatar,...c.typography.mediumAvatar,transition:"all .2s ease-in-out",background:c.palette.canvasHeader.deployLight,color:c.palette.canvasHeader.deployDark,"&:hover":{background:c.palette.canvasHeader.deployDark,color:c.palette.canvasHeader.deployLight}},color:"inherit",onClick:()=>{let e=!1;try{const n=JSON.parse(t.flowData).nodes;for(const t of n)if(t.data.inputParams.find((e=>"file"===e.type))){e=!0;break}}catch(a){console.error(a)}let n=!1;try{const e=JSON.parse(t.flowData).nodes;for(const t of e)if(t.data.inputParams.find((e=>"sessionId"===e.name))){n=!0;break}}catch(a){console.error(a)}L({title:"Embed in website or use as API",chatflowid:t.id,chatflowApiKeyId:t.apikeyid,isFormDataRequired:e,isSessionMemory:n}),F(!0)},children:(0,C.jsx)(T.seM,{stroke:1.5,size:"1.3rem"})})}),(0,C.jsxs)(g.Z,{variant:"outlined",sx:{marginRight:"2px"},size:"small","aria-label":"save",title:"Save",onClick:()=>{t.id?n(j):R(!0)},children:[(0,C.jsx)(T.e11,{stroke:1.5,size:"1.3rem"})," Save"]}),(0,C.jsxs)(g.Z,{variant:"outlined",sx:{marginRight:"2px"},size:"small","aria-label":"test",title:"Test",onClick:()=>{r()},children:[(0,C.jsx)(I.Z,{stroke:1.5,size:"1.3rem"})," Test"]}),(0,C.jsxs)(g.Z,{variant:"outlined",size:"small","aria-label":"deploy",title:"Deploy",onClick:()=>P(!M),children:[(0,C.jsx)(Me.Z,{stroke:1.5,size:"1.3rem"})," Deploy"]})]}),(0,C.jsx)(E,{show:N,dialogProps:{title:"Save New Chatflow",confirmButtonName:"Save",cancelButtonName:"Cancel"},onCancel:()=>R(!1),onConfirm:e=>{R(!1),n(e)}}),(0,C.jsx)(Ie,{show:q,dialogProps:B,onCancel:()=>F(!1)})]})};var Fe=n(81253),Be=n(23066),Ee=n(76334),Le=n(54783),He=n(6547),ze=n(33550),Oe=n(59708),_e=n(54547),Ue=n.n(_e),Ke=(n(75909),n(73272)),Je=n(71970),We=n(57775),Xe=n(15079),Ye=n(7093);const Ve=(0,a.forwardRef)((function(e,t){let{children:n,position:a,type:o,direction:s,...r}=e,i={transformOrigin:"0 0 0"};switch(a){case"top-right":i={transformOrigin:"top right"};break;case"top":i={transformOrigin:"top"};break;case"bottom-left":i={transformOrigin:"bottom left"};break;case"bottom-right":i={transformOrigin:"bottom right"};break;case"bottom":i={transformOrigin:"bottom"};break;default:i={transformOrigin:"0 0 0"}}return(0,C.jsxs)(x.Z,{ref:t,children:["grow"===o&&(0,C.jsx)(Ke.Z,{...r,children:(0,C.jsx)(x.Z,{sx:i,children:n})}),"collapse"===o&&(0,C.jsx)(Je.Z,{...r,sx:i,children:n}),"fade"===o&&(0,C.jsx)(We.Z,{...r,timeout:{appear:500,enter:600,exit:400},children:(0,C.jsx)(x.Z,{sx:i,children:n})}),"slide"===o&&(0,C.jsx)(Xe.Z,{...r,timeout:{appear:0,enter:400,exit:200},direction:s,children:(0,C.jsx)(x.Z,{sx:i,children:n})}),"zoom"===o&&(0,C.jsx)(Ye.Z,{...r,children:(0,C.jsx)(x.Z,{sx:i,children:n})})]})}));Ve.defaultProps={type:"grow",position:"top-left",direction:"up"};var Ge=n(3698),$e=(n(14213),n(30215));const Qe=e=>{let{nodesData:t,node:n,setAddNode:o}=e;const s=(0,w.Z)(),r=(0,u.v9)((e=>e.customization)),p=(0,u.I0)(),[h,m]=(0,a.useState)(""),[v,y]=(0,a.useState)({}),[b,j]=(0,a.useState)(!1),[k,Z]=(0,a.useState)({}),[S,A]=(0,a.useState)(""),[I,M]=a.useState(!1),P=(0,a.useRef)(null),N=(0,a.useRef)(b),R=(0,a.useRef)(),F=()=>{const e=R.current;e&&(e.scrollTop=0)},B=e=>{m(e),setTimeout((()=>{if(e){const n=(e=>t.filter((t=>{const n=t.name.toLowerCase().includes(e.toLowerCase()),a=t.category.toLowerCase().includes(e.toLowerCase());return n||a})))(e);E(n,!0),F()}else""===e&&(E(t),F())}),500)},E=(e,t)=>{const n={},a=e.reduce((function(e,a){return e[a.category]=e[a.category]||[],e[a.category].push(a),n[a.category]=!!t,e}),Object.create(null));y(a),Z(n)};console.log(v);const L=e=>(t,n)=>{const a={...k};a[e]=n,Z(a)};return(0,a.useEffect)((()=>{!0===N.current&&!1===b&&P.current.focus(),N.current=b}),[b]),(0,a.useEffect)((()=>{n&&j(!1)}),[n]),(0,a.useEffect)((()=>{t&&(E(t),p({type:f.gU,componentNodes:t}))}),[t,p]),(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)($e.Z,{show:I,onCancel:()=>M(!1)}),(0,C.jsx)(x.Z,{sx:{display:"flex",justifyContent:"end"},children:(0,C.jsx)(Ge.Z,{sx:{borderRadius:"9px",marginRight:"4px",color:"red",cursor:"pointer"},onClick:()=>{o(!1)}})}),(0,C.jsxs)(x.Z,{sx:{px:2},children:[(0,C.jsx)(D.Z,{children:(0,C.jsx)(d.Z,{variant:"h4",children:"Add Nodes"})}),(0,C.jsx)(q.Z,{sx:{width:"100%",pr:2,pl:2,my:2},id:"input-search-node",value:h,onChange:e=>B(e.target.value),placeholder:"Search nodes",startAdornment:(0,C.jsx)(Fe.Z,{position:"start",children:(0,C.jsx)(T.jVj,{stroke:1.5,size:"1rem",color:s.palette.grey[500]})}),endAdornment:(0,C.jsx)(Fe.Z,{position:"end",sx:{cursor:"pointer",color:s.palette.grey[500],"&:hover":{color:s.palette.grey[900]}},title:"Clear Search",children:(0,C.jsx)(T.kLi,{stroke:1.5,size:"1rem",onClick:()=>B(""),style:{cursor:"pointer"}})}),"aria-describedby":"search-helper-text",inputProps:{"aria-label":"weight"}}),(0,C.jsx)(Be.Z,{})]}),(0,C.jsxs)(x.Z,{sx:{px:2},children:[(0,C.jsx)(g.Z,{sx:{width:"100%",pr:1,pl:2,my:2},onClick:()=>{M(!0)},style:{cursor:"pointer",background:"cornflowerblue",color:"white",borderRadius:"20px"},children:"Add Node Through AI"}),(0,C.jsx)(Be.Z,{})]}),(0,C.jsx)(Ue(),{containerRef:e=>{R.current=e},style:{height:"100%",maxHeight:"calc(100vh - 320px)",overflowX:"hidden"},children:(0,C.jsx)(x.Z,{sx:{p:2},children:(0,C.jsx)(Ee.Z,{sx:{width:"100%",maxWidth:370,py:0,borderRadius:"10px",[s.breakpoints.down("md")]:{maxWidth:370},"& .MuiListItemSecondaryAction-root":{top:22},"& .MuiDivider-root":{my:0},"& .list-container":{pl:7}},children:Object.keys(v).sort().map((e=>(0,C.jsxs)(i.Z,{expanded:k[e]||!1,onChange:L(e),disableGutters:!0,children:[(0,C.jsx)(l.Z,{expandIcon:(0,C.jsx)(O.Z,{}),"aria-controls":"nodes-accordian-".concat(e),id:"nodes-accordian-header-".concat(e),children:(0,C.jsx)(d.Z,{variant:"h5",children:e})}),(0,C.jsx)(c.Z,{children:v[e].map(((t,n)=>(0,C.jsxs)("div",{onDragStart:e=>((e,t)=>{e.dataTransfer.setData("application/reactflow",JSON.stringify(t)),e.dataTransfer.effectAllowed="move"})(e,t),draggable:!0,children:[(0,C.jsx)(Le.Z,{sx:{p:0,borderRadius:"".concat(r.borderRadius,"px"),cursor:"move"},children:(0,C.jsxs)(He.ZP,{alignItems:"center",children:[(0,C.jsx)(ze.Z,{children:(0,C.jsx)("div",{style:{width:50,height:50,borderRadius:"50%",backgroundColor:"white"},children:(0,C.jsx)("img",{style:{width:"100%",height:"100%",padding:10,objectFit:"contain"},alt:t.displayName,src:t.logoUrl})})}),(0,C.jsx)(Oe.Z,{sx:{ml:1},primary:null===t||void 0===t?void 0:t.displayName,secondary:t.description})]})}),n===v[e].length-1?null:(0,C.jsx)(Be.Z,{})]},t.displayName)))})]},e)))})})})]})};var et=n(48580),tt=n(68089),nt=n(65953),at=n(8035),ot=n(60535),st=n(68674),rt=n(4716),it=n(18958),lt=n(65806);const ct={javascript:".js",python:".py",java:".java",c:".c",cpp:".cpp","c++":".cpp","c#":".cs",ruby:".rb",php:".php",swift:".swift","objective-c":".m",kotlin:".kt",typescript:".ts",go:".go",perl:".pl",rust:".rs",scala:".scala",haskell:".hs",lua:".lua",shell:".sh",sql:".sql",html:".html",css:".css"},dt=(0,a.memo)((e=>{var t;let{language:n,chatflowid:o,isDialog:s,value:r}=e;const i=(0,w.Z)(),[l,c]=(0,a.useState)(null),u=Boolean(l),p=()=>{c(null)};return(0,C.jsxs)("div",{style:{width:s?"":300},children:[(0,C.jsx)(x.Z,{sx:{color:"white",background:null===(t=i.palette)||void 0===t?void 0:t.common.dark,p:1,borderTopLeftRadius:10,borderTopRightRadius:10},children:(0,C.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[n,(0,C.jsx)("div",{style:{flex:1}}),(0,C.jsx)(J.Z,{size:"small",title:"Copy",color:"success",onClick:e=>{navigator.clipboard&&navigator.clipboard.writeText&&(navigator.clipboard.writeText(r),c(e.currentTarget),setTimeout((()=>{p()}),1500))},children:(0,C.jsx)(T.Rx8,{})}),(0,C.jsx)(W.ZP,{open:u,anchorEl:l,onClose:p,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},children:(0,C.jsx)(d.Z,{variant:"h6",sx:{pl:1,pr:1,color:"white",background:i.palette.success.dark},children:"Copied!"})}),(0,C.jsx)(J.Z,{size:"small",title:"Download",color:"primary",onClick:()=>{const e=ct[n]||".file",t="file-".concat(o).concat(e);if(!t)return;const a=new Blob([r],{type:"text/plain"}),s=URL.createObjectURL(a),i=document.createElement("a");i.download=t,i.href=s,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s)},children:(0,C.jsx)(T.DjJ,{})})]})}),(0,C.jsx)(it.Z,{language:n,style:lt.Z,customStyle:{margin:0},children:r})]})}));dt.displayName="CodeBlock";var ut=n(33505);const pt=(0,a.memo)(ut.D,((e,t)=>e.children===t.children)),ht=e=>{let{show:t,dialogProps:n,onCancel:o}=e;const[s,r]=(0,a.useState)(null);(0,u.v9)((e=>e.customization));(0,a.useEffect)((()=>{r(document.getElementById("portal"))}),[t]);const[i,l]=(0,a.useState)({});(0,a.useEffect)((()=>(n.data&&l(n.data),()=>{l({})})),[n]);const c=t?(0,C.jsxs)(P.Z,{onClose:o,open:t,fullWidth:!0,maxWidth:"sm","aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,C.jsx)(N.Z,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:"Source Document"}),(0,C.jsx)(R.Z,{})]}):null;return s?(0,M.createPortal)(c,s):null},ft=e=>ve.Z.get("/chatmessage/".concat(e)),mt=(e,t)=>ve.Z.post("/chatmessage/".concat(e),t),gt=(e,t)=>ve.Z.post("/internal-prediction/".concat(e),t);var xt=n(47804);const vt=n.p+"static/media/account.bccec459ac1b2deab2d2.png",yt=e=>{let{open:t,chatflowid:n,isDialog:o,chatType:s}=e;const r=(0,w.Z)(),i=(0,u.v9)((e=>e.customization)),l=(0,a.useRef)(),[c,d]=(0,a.useState)(""),[p,h]=(0,a.useState)(!1),[f,g]=(0,a.useState)([{message:"Hi there! How can I help?",type:"apiMessage"}]),[v,y]=(0,a.useState)(""),[b,j]=(0,a.useState)(!1),[k,Z]=(0,a.useState)(!1),[S,D]=(0,a.useState)({}),A=(0,a.useRef)(null),I=(0,be.Z)(ft),M=(0,be.Z)(Y.Z.getIsChatflowStreaming),P=e=>{const t=[],n=[];return e.sourceDocuments.forEach((e=>{(0,Te.K2)(e.metadata.source)&&!t.includes(e.metadata.source)?(t.push(e.metadata.source),n.push(e)):(0,Te.K2)(e.metadata.source)||n.push(e)})),n},N=()=>{l.current&&l.current.scrollTo({top:G.bs})},R=(0,a.useCallback)((e=>d(e.target.value)),[d]),F=async(e,t,a)=>{try{const o={role:t,content:e,chatflowid:n};a&&(o.sourceDocuments=JSON.stringify(a)),await mt(n,o)}catch(o){console.error(o)}},B=e=>{g((t=>{let n=[...(0,m.cloneDeep)(t)];return"userMessage"===n[n.length-1].type||(n[n.length-1].message+=e),n}))},E=e=>{g((t=>{let n=[...(0,m.cloneDeep)(t)];return"userMessage"===n[n.length-1].type||(n[n.length-1].sourceDocuments=e),n}))},L=async e=>{if(e.preventDefault(),""!==c.trim()){h(!0),g((e=>[...e,{message:c,type:"userMessage"}])),await F(c,"userMessage");try{const e={question:c,history:f.filter((e=>"Hi there! How can I help?"!==e.message))};b&&(e.socketIOClientId=v);const t=await gt(n,e);if(t.data){const e=t.data;"object"===typeof e&&e.text&&e.sourceDocuments?(b||g((t=>[...t,{message:e.text,sourceDocuments:e.sourceDocuments,type:"apiMessage"}])),F(e.text,"apiMessage",e.sourceDocuments)):(b||g((t=>[...t,{message:e,type:"apiMessage"}])),F(e,"apiMessage")),h(!1),d(""),setTimeout((()=>{var e;null===(e=A.current)||void 0===e||e.focus(),N()}),100)}}catch(t){return void function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Oops! There seems to be an error. Please try again.";e=e.replace("Unable to parse JSON response from chat agent.\n\n",""),g((t=>[...t,{message:e,type:"apiMessage"}])),F(e,"apiMessage"),h(!1),d(""),setTimeout((()=>{var e;null===(e=A.current)||void 0===e||e.focus()}),100)}(t.response.data||"".concat(t.response.status,": ").concat(t.response.statusText))}}};return(0,a.useEffect)((()=>{if(I.data){const e=[];for(const t of I.data){const n={message:t.content,type:t.role};t.sourceDocuments&&(n.sourceDocuments=JSON.parse(t.sourceDocuments)),e.push(n)}g((t=>[...t,...e]))}}),[I.data]),(0,a.useEffect)((()=>{var e,t;M.data&&j(null!==(e=null===(t=M.data)||void 0===t?void 0:t.isStreaming)&&void 0!==e&&e)}),[M.data]),(0,a.useEffect)((()=>{N()}),[f]),(0,a.useEffect)((()=>{o&&A&&setTimeout((()=>{var e;null===(e=A.current)||void 0===e||e.focus()}),100)}),[o,A]),(0,a.useEffect)((()=>{let e;return t&&n&&(I.request(n),M.request(n),N(),e=(0,tt.ZP)(G.v2),e.on("connect",(()=>{y(e.id)})),e.on("start",(()=>{g((e=>[...e,{message:"",type:"apiMessage"}]))})),e.on("sourceDocuments",E),e.on("token",B)),()=>{d(""),h(!1),g([{message:"Hi there! How can I help?",type:"apiMessage"}]),e&&(e.disconnect(),y(""))}}),[t,n]),(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("div",{className:o?"cloud-dialog":"testchat"===s?"cloud":"node-ai",children:(0,C.jsx)("div",{ref:l,className:"messagelist",children:f&&f.map(((e,t)=>(0,C.jsxs)(x.Z,{sx:{background:"apiMessage"===e.type?r.palette.asyncSelect.main:""},style:{display:"flex"},className:"userMessage"===e.type&&p&&t===f.length-1?i.isDarkMode?"usermessagewaiting-dark":"usermessagewaiting-light":"usermessagewaiting"===e.type?"apimessage":"usermessage",children:["apiMessage"===e.type?(0,C.jsx)("img",{src:xt,alt:"AI",width:"30",height:"30",className:"boticon"}):(0,C.jsx)("img",{src:vt,alt:"Me",width:"30",height:"30",className:"usericon"}),(0,C.jsxs)("div",{style:{display:"flex",flexDirection:"column",width:"100%"},children:[(0,C.jsx)("div",{className:"markdownanswer",children:(0,C.jsx)(pt,{remarkPlugins:[at.Z,ot.Z],rehypePlugins:[nt.Z],components:{code(e){let{inline:t,className:a,children:s,...r}=e;const i=/language-(\w+)/.exec(a||"");return t?(0,C.jsx)("code",{className:a,...r,children:s}):(0,C.jsx)(dt,{chatflowid:n,isDialog:o,language:i&&i[1]||"",value:String(s).replace(/\n$/,""),...r},Math.random())}},children:e.message})}),e.sourceDocuments&&(0,C.jsx)("div",{style:{display:"block",flexDirection:"row",width:"100%"},children:P(e).map(((e,t)=>{const n=(0,Te.K2)(e.metadata.source);return(0,C.jsx)(st.Z,{size:"small",label:n?"/"===n.pathname.substring(0,15)?n.host:"".concat(n.pathname.substring(0,15),"..."):"".concat(e.pageContent.substring(0,15),"..."),component:"a",sx:{mr:1,mb:1},variant:"outlined",clickable:!0,onClick:()=>{return n?(t=e.metadata.source,void window.open(t,"_blank")):(e=>{D({data:e}),Z(!0)})(e);var t}},t)}))})]})]},t)))})}),(0,C.jsx)(Be.Z,{}),(0,C.jsx)("div",{className:"center",children:(0,C.jsx)("div",{style:{width:"100%"},children:(0,C.jsx)("form",{style:{width:"100%"},onSubmit:L,children:(0,C.jsx)(q.Z,{inputRef:A,autoFocus:!0,sx:{width:"100%"},onKeyDown:e=>{const t=e.isComposing||229===e.keyCode;"Enter"===e.key&&c&&!t?!e.shiftKey&&c&&L(e):"Enter"===e.key&&e.preventDefault()},id:"userInput",name:"userInput",placeholder:p?"Waiting for response...":"Type your question...",value:c,onChange:R,multiline:!0,maxRows:o?7:2,endAdornment:(0,C.jsx)(Fe.Z,{position:"end",sx:{padding:"15px"},children:(0,C.jsx)(J.Z,{type:"submit",disabled:p||!n,edge:"end",children:p?(0,C.jsx)("div",{children:(0,C.jsx)(rt.Z,{color:"inherit",size:20})}):(0,C.jsx)(T.h9l,{color:p||!n?"#9e9e9e":i.isDarkMode?"white":"#1e88e5"})})})})})})}),(0,C.jsx)(ht,{show:k,dialogProps:S,onCancel:()=>Z(!1)})]})};var wt=n(85745);var bt=n(10702),jt=n(94715);const Ct={customNode:b.Z},kt={buttonedge:k},Zt=()=>{(0,w.Z)();const e=(0,p.s0)(),{state:t}=(0,p.TH)(),n=null!==t&&void 0!==t&&t.flowDetails?t.flowDetails:"",b=document.location.pathname.toString().split("/");console.log(b);const k="canvas"===b[b.length-1]?"":b[b.length-1],{confirm:Z}=(0,wt.Z)(),S=(0,u.I0)(),D=(0,u.v9)((e=>e.canvas)),[A,I]=(0,a.useState)(D),[M,P]=(0,a.useState)(!0),[N,R]=(0,a.useState)(null),[q,F]=(0,a.useState)(!1),{reactFlowInstance:B,setReactFlowInstance:E}=(0,a.useContext)(j.K),[L,H]=(0,a.useState)([]),[z,O]=(0,a.useState)(!1);(0,V.Z)();const _=function(){return S((0,f.yv)(...arguments))},U=function(){return S((0,f.sy)(...arguments))},[K,J,W]=(0,o.Rr)(),[X,$,Q]=(0,o.ll)(),[ee,te]=(0,a.useState)(null),ne=(0,a.useRef)(null),ae=(0,be.Z)(bt.Z.getAllNodes),oe=(0,be.Z)(Y.Z.createNewChatflow),se=((0,be.Z)(Y.Z.createNewChatflowVersion),(0,be.Z)(Y.Z.testChatflow)),re=(0,be.Z)(Y.Z.updateChatflow),ie=(0,be.Z)(Y.Z.getSpecificChatflow),le=e=>{try{var t,n,a,s;null===e||void 0===e||null===(t=e.flowData)||void 0===t||null===(n=t.nodes)||void 0===n||n.forEach((e=>{let t={id:null===e||void 0===e?void 0:e.id,position:e.position,type:"customNode",data:null===e||void 0===e?void 0:e.data};J((e=>e.concat(t)))})),null===e||void 0===e||null===(a=e.flowData)||void 0===a||null===(s=a.edges)||void 0===s||s.forEach((e=>{let t={id:e.id,type:e.type,source:e.source,target:e.target,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle};$((e=>(0,o.Z_)(t,e)))}))}catch(r){console.error(r)}},ce=(0,a.useCallback)(((e,t)=>{te(t),J((e=>e.map((e=>(e.id===t.id?e.data={...e.data,selected:!0}:e.data={...e.data,selected:!1},e)))))})),de=(0,a.useCallback)((e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"}),[]),ue=(0,a.useCallback)((e=>{e.preventDefault();const t=ne.current.getBoundingClientRect();let n=e.dataTransfer.getData("application/reactflow");if("undefined"===typeof n||!n)return;n=JSON.parse(n);const a=B.project({x:e.clientX-t.left-100,y:e.clientY-t.top-50}),o=(0,Te.VZ)(n,B.getNodes()),s={id:o,position:a,type:"customNode",data:(0,Te.qR)(n,o)};te(s),J((e=>e.concat(s).map((e=>(e.id===s.id?e.data={...e.data,selected:!0}:e.data={...e.data,selected:!1},e))))),setTimeout((()=>fe()),0)}),[B]),pe=()=>{S({type:f.cn}),_({message:"Chatflow saved",options:{key:(new Date).getTime()+Math.random(),variant:"success",action:e=>(0,C.jsx)(g.Z,{style:{color:"white"},onClick:()=>U(e),children:(0,C.jsx)(T.kLi,{})})}})},he=e=>{_({message:e,options:{key:(new Date).getTime()+Math.random(),variant:"error",persist:!0,action:e=>(0,C.jsx)(g.Z,{style:{color:"white"},onClick:()=>U(e),children:(0,C.jsx)(T.kLi,{})})}})},fe=()=>{S({type:f.K8})};return(0,a.useEffect)((()=>{if(ie.data){const e=ie.data,t=e.flowData?JSON.parse(e.flowData):[];J(t.nodes||[]),$(t.edges||[]),S({type:f.ch,chatflow:e})}else if(ie.error){const e=ie.error,t=e.response.data||"".concat(e.response.status,": ").concat(e.response.statusText);he("Failed to retrieve chatflow: ".concat(t))}}),[ie.data,ie.error]),(0,a.useEffect)((()=>{if(oe.data){const e=oe.data;S({type:f.ch,chatflow:e}),pe(),window.history.replaceState(null,null,"/canvas/".concat(e.id))}else if(oe.error){const e=oe.error,t=e.response.data||"".concat(e.response.status,": ").concat(e.response.statusText);he("Failed to save chatflow: ".concat(t))}}),[oe.data,oe.error]),(0,a.useEffect)((()=>{if(re.data)S({type:f.ch,chatflow:re.data}),pe();else if(re.error){const e=re.error,t=e.response.data||"".concat(e.response.status,": ").concat(e.response.statusText);he("Failed to save chatflow: ".concat(t))}}),[re.data,re.error]),(0,a.useEffect)((()=>{se.error&&_({message:"Test chatflow failed",options:{key:(new Date).getTime()+Math.random(),variant:"error",persist:!0,action:e=>(0,C.jsx)(g.Z,{style:{color:"white"},onClick:()=>U(e),children:(0,C.jsx)(T.kLi,{})})}})}),[se.error]),(0,a.useEffect)((()=>R(A.chatflow)),[A.chatflow]),(0,a.useEffect)((()=>(k?ie.request(k):(localStorage.getItem("duplicatedFlowData")?(le(localStorage.getItem("duplicatedFlowData")),setTimeout((()=>localStorage.removeItem("duplicatedFlowData")),0)):(J([]),$([])),S({type:f.ch,chatflow:{name:"Untitled chatflow"}})),ae.request(),()=>{setTimeout((()=>S({type:f.cn})),0)})),[]),console.log(ae),(0,a.useEffect)((()=>{I(D)}),[D]),(0,a.useEffect)((()=>{function e(e){const t=e.clipboardData.getData("text");t.includes('{"nodes":[')&&t.includes('],"edges":[')&&le(t)}return window.addEventListener("paste",e),()=>{window.removeEventListener("paste",e)}}),[]),(0,a.useEffect)((()=>{n&&le(n)}),[n]),h("You have unsaved changes! Do you want to navigate away?",A.isDirty),(0,C.jsx)(C.Fragment,{children:(0,C.jsxs)(x.Z,{children:[(0,C.jsx)(v.Z,{sx:{border:"1px solid lightgrey"},children:(0,C.jsx)(qe,{chatflow:N,handleSaveFlow:e=>{if(console.log(e),B){const t=B.getNodes().map((e=>{const t=(0,m.cloneDeep)(e.data);return Object.prototype.hasOwnProperty.call(t.inputs,G.J6)&&(t.credential=t.inputs[G.J6],t.inputs=(0,m.omit)(t.inputs,[G.J6])),e.data={...t,selected:!1},e})),n=B.toObject();n.nodes=t;const a=n;if(N.id){const t={name:e,flowData:a};re.request(N.id,t)}else{const t={displayName:e,deployed:!1,isPublic:!1,flowData:a};oe.request(t)}}},handleDeleteFlow:async()=>{const t={title:"Delete",description:"Delete chatflow ".concat(N.name,"?"),confirmButtonName:"Delete",cancelButtonName:"Cancel"};if(await Z(t))try{await Y.Z.deleteChatflow(N.id),e(-1)}catch(n){const e=n.response.data||"".concat(n.response.status,": ").concat(n.response.statusText);_({message:e,options:{key:(new Date).getTime()+Math.random(),variant:"error",persist:!0,action:e=>(0,C.jsx)(g.Z,{style:{color:"white"},onClick:()=>U(e),children:(0,C.jsx)(T.kLi,{})})}})}},handleLoadFlow:le,openChatBox:()=>{O(!z)},templateFlowData:n,agentflowName:null===t||void 0===t?void 0:t.agetWorkFlowValue})}),q&&(0,C.jsx)(x.Z,{className:"box-inline",sx:{height:"100vh",width:"100%",position:"fixed",left:"5%"}}),M&&!q?(0,C.jsx)(x.Z,{className:"box-inline",sx:{height:"100vh",width:"20%",zIndex:"300",border:"1px solid lightgrey"},children:(0,C.jsx)(y.Z,{sx:{height:"90vh"},children:(0,C.jsx)(Qe,{nodesData:null===ae||void 0===ae?void 0:ae.data,node:ee,setAddNode:P})})}):!q&&(0,C.jsxs)(x.Z,{className:"box-inline",sx:{position:"fixed",zIndex:"300"},children:[" ",(0,C.jsxs)(Re,{sx:{left:20,top:8},size:"small","aria-label":"add",title:"Add Node",variant:"extended",onClick:()=>{P(!0)},children:[(0,C.jsx)(T.SC9,{})," Add Nodes"]})]}),!q&&(0,C.jsx)(x.Z,{className:"box-inline",sx:{height:"100vh",width:"100%",position:"fixed"},children:(0,C.jsx)("div",{className:"reactflow-parent-wrapper",children:(0,C.jsx)("div",{className:"reactflow-wrapper",ref:ne,children:(0,C.jsxs)(o.x$,{nodes:K,edges:X,onNodesChange:W,onNodeClick:ce,onEdgesChange:Q,onDrop:ue,onDragOver:de,onNodeDragStop:fe,nodeTypes:Ct,edgeTypes:kt,onConnect:e=>{const t=e.sourceHandle.split("-")[2],n={...e,type:"buttonedge",id:"".concat(e.source,"-").concat(e.sourceHandle,"-").concat(e.target,"-").concat(e.targetHandle),data:{label:(0,Te.Mw)(e.sourceHandle)},style:"control"===t?{stroke:"red",strokeWidth:3}:{}},a=e.targetHandle.split("-")[0],s=e.sourceHandle.split("-")[0],r=e.targetHandle.split("-")[2];J((e=>e.map((e=>{if(e.id===a){let t;setTimeout((()=>fe()),0);const n=e.data.inputAnchors.find((e=>e.name===r)),a=e.data.inputParams.find((e=>e.name===r));if(n&&n.list){const n=e.data.inputs[r]||[];"tools"===r?(0,Te.kG)(n,s):n.push("{{".concat(s,".data.instance}}")),t=n}else t=a&&a.acceptVariable?e.data.inputs[r]||"":"{{".concat(s,".data.instance}}");e.data={...e.data,inputs:{...e.data.inputs,[r]:t}}}return e})))),$((e=>(0,o.Z_)(n,e)))},onInit:E,fitView:!0,deleteKeyCode:D.canvasDialogShow?null:["Backspace","Delete"],minZoom:.1,maxZoom:1.2,children:[(0,C.jsx)(s.Z,{}),(0,C.jsx)(r.A,{color:"#aaa",gap:16}),(0,C.jsx)("div",{className:"node-ai-chat",children:(0,C.jsxs)(i.Z,{children:[(0,C.jsx)(l.Z,{sx:{backgroundColor:"gainsboro"},expandIcon:(0,C.jsx)(jt.Z,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:(0,C.jsx)(d.Z,{children:"Update Flow Through AI"})}),(0,C.jsx)(c.Z,{sx:{border:"1px solid lightgray",padding:"0px",position:"relative",top:"-283px"},children:(0,C.jsx)(y.Z,{children:(0,C.jsx)(yt,{chatType:"nodeai"})})})]})})]})})})}),z&&(0,C.jsx)(x.Z,{className:"box-inline",sx:{height:"100vh",width:"25%",position:"absolute",border:"1px solid lightgrey"},children:(0,C.jsx)(y.Z,{children:(0,C.jsx)(yt,{chatType:"testchat"})})}),(0,C.jsx)(et.Z,{})]})})}}}]);
//# sourceMappingURL=5677.47ef2af9.chunk.js.map